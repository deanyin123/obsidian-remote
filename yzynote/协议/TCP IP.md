# 1.在TCP连接中，如果先占用一个端口，再用这个端口绑定新的socket，会发生什么？
   默认情况下，新套接字绑定已被占用的TCP端口会失败‌，通过设置`SO_REUSEADDR`或`SO_REUSEPORT`，或在不同的IP地址上绑定，可绕过此限
   SO_REUSEADDR和SO_REUSEPORT的区别是什么？

| ‌**功能**‌        | ‌**`SO_REUSEADDR`**‌                    | ‌**`SO_REUSEPORT`**‌ |
| --------------- | --------------------------------------- | -------------------- |
| ‌**主要目的**‌      | 解决端口占用问题（如`TIME_WAIT`状态）                | 解决单进程瓶颈问题（多进程负载均衡）   |
| ‌**典型场景**‌      | 服务器快速重启，避免TIME_WAIT问题<br>多IP绑定<br>UDP组播 | 高并发服务器（如Nginx、游戏服务器） |
| ‌**是否允许多进程绑定**‌ | 否（除非绑定不同IP）                             | 是（多个进程可绑定同一IP和端口）    |
|                 |                                         |                      |

# 2.TCP为什么需要三次握手和四次挥手？

| **机制**‌    | ‌**核心目的**‌                                                                                                                                                               | ‌**必要性解释**‌          |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------- |
| ‌**三次握手**‌ | 1.确认双向通信能力<br>2.防止历史连接干扰<br>3.同步初始序列号                                                                                                                                    | 两次握手无法验证双方能力，四次握手冗余‌ |
| ‌**四次挥手**‌ | 1.TCP连接是双向的，需分别关闭发送 和接收通道<br>2. 确保数据完整性，被动关闭方可能仍有未发送完的数据，需在收到 FIN 后继续传输，最后再发送 FIN 确认关闭<br>3.处理延迟报文,TIME_WAIT 状态（主动关闭方等待 2MSL 时间），确保最后一个 ACK 到达被动关闭方，防止其因未收到 ACK 而重传 FIN‌ | TCP 全双工特性要求独立关闭每个方向‌ |

1. ‌**为什么三次握手不能携带数据？**‌
    
    - SYN 报文（第一次和第二次握手）不能携带数据，避免攻击者利用大量数据耗尽资源‌7。第三次握手可携带数据‌7。
2. ‌**为什么不能合并四次挥手为三次？**‌
    
    - 被动关闭方的 ACK 和 FIN 可能因数据未发送完毕而无法合并，需分开发送‌

# 3.